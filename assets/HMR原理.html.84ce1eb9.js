import{_ as t}from"./plugin-vue_export-helper.21dcd24c.js";import{o as e,c as d,e as r}from"./app.b9034ddb.js";const b={},a=r('<h1 id="hmr-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#hmr-\u539F\u7406" aria-hidden="true">#</a> HMR \u539F\u7406</h1><p><img src="https://ae01.alicdn.com/kf/Hdde49d41b1fa4436bdc2e776fa6533b2C.png" alt="1608382424775.png"></p><h2 id="\u670D\u52A1\u5668\u90E8\u5206" tabindex="-1"><a class="header-anchor" href="#\u670D\u52A1\u5668\u90E8\u5206" aria-hidden="true">#</a> \u670D\u52A1\u5668\u90E8\u5206</h2><table><thead><tr><th>\u6B65\u9AA4</th><th>\u4EE3\u7801\u4F4D\u7F6E</th></tr></thead><tbody><tr><td>1.\u542F\u52A8 webpack-dev-server \u670D\u52A1\u5668</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/bin/webpack-dev-server.js#L83</td></tr><tr><td>2.\u521B\u5EFA webpack \u5B9E\u4F8B</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/bin/webpack-dev-server.js#L89</td></tr><tr><td>3.\u521B\u5EFA Server \u670D\u52A1\u5668</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/bin/webpack-dev-server.js#L107</td></tr><tr><td><strong>4.\u66F4\u6539 config \u7684 entry \u5C5E\u6027</strong></td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L57</td></tr><tr><td>entry \u6DFB\u52A0 dev-server/client/index.js</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/utils/addEntries.js#L22</td></tr><tr><td>entry \u6DFB\u52A0 webpack/hot/dev-server.js</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/utils/addEntries.js#L30</td></tr><tr><td>5. setupHooks</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L122</td></tr><tr><td><strong>6. \u6DFB\u52A0 webpack \u7684 done \u4E8B\u4EF6\u56DE\u8C03</strong></td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L183</td></tr><tr><td>\u7F16\u8BD1\u5B8C\u6210\u5411 websocket \u5BA2\u6237\u7AEF\u63A8\u9001\u6D88\u606F\uFF0C\u6700\u4E3B\u8981\u4FE1\u606F\u8FD8\u662F\u65B0\u6A21\u5757\u7684 hash \u503C\uFF0C\u540E\u9762\u7684\u6B65\u9AA4\u6839\u636E\u8FD9\u4E00 hash \u503C\u6765\u8FDB\u884C\u6A21\u5757\u70ED\u66FF\u6362</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L178</td></tr><tr><td>7.\u521B\u5EFA express \u5E94\u7528 app</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L169</td></tr><tr><td>8. \u6DFB\u52A0 webpack-dev-middleware \u4E2D\u95F4\u4EF6</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L208</td></tr><tr><td>\u4EE5 watch \u6A21\u5F0F\u542F\u52A8 webpack \u7F16\u8BD1\uFF0C\u6587\u4EF6\u7CFB\u7EDF\u4E2D\u67D0\u4E00\u4E2A\u6587\u4EF6\u53D1\u751F\u4FEE\u6539\uFF0Cwebpack \u76D1\u542C\u5230\u6587\u4EF6\u53D8\u5316\uFF0C\u6839\u636E\u914D\u7F6E\u6587\u4EF6\u5BF9\u6A21\u5757\u91CD\u65B0\u7F16\u8BD1\u6253\u5305</td><td>https://github.com/webpack/webpack-dev-middleware/blob/v3.7.2/index.js#L41</td></tr><tr><td><strong>\u8BBE\u7F6E\u6587\u4EF6\u7CFB\u7EDF\u4E3A\u5185\u5B58\u6587\u4EF6\u7CFB\u7EDF</strong></td><td>https://github.com/webpack/webpack-dev-middleware/blob/v3.7.2/index.js#L65</td></tr><tr><td><strong>\u8FD4\u56DE\u4E00\u4E2A\u4E2D\u95F4\u4EF6\uFF0C\u8D1F\u8D23\u8FD4\u56DE\u751F\u6210\u7684\u6587\u4EF6</strong></td><td>https://github.com/webpack/webpack-dev-middleware/blob/v3.7.2/lib/middleware.js#L20</td></tr><tr><td>app \u4E2D\u4F7F\u7528 webpack-dev-middlerware \u8FD4\u56DE\u7684\u4E2D\u95F4\u4EF6</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L128</td></tr><tr><td>9. \u521B\u5EFA http \u670D\u52A1\u5668\u5E76\u542F\u52A8\u670D\u52A1</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L135</td></tr><tr><td><strong>10. \u4F7F\u7528 sockjs \u5728\u6D4F\u89C8\u5668\u7AEF\u548C\u670D\u52A1\u7AEF\u4E4B\u95F4\u5EFA\u7ACB\u4E00\u4E2A websocket \u957F\u8FDE\u63A5</strong></td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/Server.js#L745</td></tr><tr><td>\u521B\u5EFA socket \u670D\u52A1\u5668\u5E76\u76D1\u542C connection \u4E8B\u4EF6</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/lib/servers/SockJSServer.js#L33</td></tr></tbody></table><h2 id="\u5BA2\u6237\u7AEF\u90E8\u5206" tabindex="-1"><a class="header-anchor" href="#\u5BA2\u6237\u7AEF\u90E8\u5206" aria-hidden="true">#</a> \u5BA2\u6237\u7AEF\u90E8\u5206</h2><table><thead><tr><th>\u6B65\u9AA4</th><th>\u4EE3\u7801\u4F4D\u7F6E</th></tr></thead><tbody><tr><td>1.\u8FDE\u63A5 websocket \u670D\u52A1\u5668</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/client-src/default/socket.js#L25</td></tr><tr><td>2.websocket \u5BA2\u6237\u7AEF\u76D1\u542C\u4E8B\u4EF6</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/client-src/default/socket.js#L53</td></tr><tr><td>\u76D1\u542C hash \u4E8B\u4EF6\uFF0C\u4FDD\u5B58\u6B64 hash \u503C</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/client-src/default/index.js#L55</td></tr><tr><td>3.\u76D1\u542C ok \u4E8B\u4EF6\uFF0C\u6267\u884C reloadApp \u65B9\u6CD5\u8FDB\u884C\u66F4\u65B0</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/client-src/default/index.js#L93</td></tr><tr><td>4. \u5728 reloadApp \u4E2D\u4F1A\u8FDB\u884C\u5224\u65AD\uFF0C\u662F\u5426\u652F\u6301\u70ED\u66F4\u65B0\uFF0C\u5982\u679C\u652F\u6301\u7684\u8BDD\u53D1\u5C04 webpackHotUpdate \u4E8B\u4EF6,\u5982\u679C\u4E0D\u652F\u6301\u5219\u76F4\u63A5\u5237\u65B0\u6D4F\u89C8\u5668</td><td>https://github.com/webpack/webpack-dev-server/blob/v3.7.2/client-src/default/utils/reloadApp.js#L7</td></tr><tr><td>5. \u5728 webpack/hot/dev-server.js \u4F1A\u76D1\u542C webpackHotUpdate \u4E8B\u4EF6</td><td>https://github.com/webpack/webpack/blob/v4.39.1/hot/dev-server.js#L55</td></tr><tr><td>6. \u5728 check \u65B9\u6CD5\u91CC\u4F1A\u8C03\u7528 module.hot.check \u65B9\u6CD5</td><td>https://github.com/webpack/webpack/blob/v4.39.1/hot/dev-server.js#L13</td></tr><tr><td>7. \u8C03\u7528 hotDownloadManifest\uFF0C\u5411 server \u7AEF\u53D1\u9001 Ajax \u8BF7\u6C42\uFF0C\u670D\u52A1\u7AEF\u8FD4\u56DE\u4E00\u4E2A Manifest \u6587\u4EF6(lastHash.hot-update.json)\uFF0C\u8BE5 Manifest \u5305\u542B\u4E86\u672C\u6B21\u7F16\u8BD1 hash \u503C \u548C \u66F4\u65B0\u6A21\u5757\u7684 chunk \u540D</td><td>https://github.com/webpack/webpack/blob/v4.39.1/lib/HotModuleReplacement.runtime.js#L180</td></tr><tr><td>8. \u8C03\u7528 JsonpMainTemplate.runtime \u7684 hotDownloadUpdateChunk \u65B9\u6CD5\u901A\u8FC7 JSONP \u8BF7\u6C42\u83B7\u53D6\u5230\u6700\u65B0\u7684\u6A21\u5757\u4EE3\u7801</td><td>https://github.com/webpack/webpack/blob/v4.39.1/lib/web/JsonpMainTemplate.runtime.js#L14</td></tr><tr><td>9. \u8865\u4E01 JS \u53D6\u56DE\u6765\u540E\u4F1A\u8C03\u7528 JsonpMainTemplate.runtime.js \u7684 webpackHotUpdate \u65B9\u6CD5</td><td>https://github.com/webpack/webpack/blob/v4.39.1/lib/web/JsonpMainTemplate.runtime.js#L8</td></tr><tr><td>10. \u7136\u540E\u4F1A\u8C03\u7528 HotModuleReplacement.runtime.js \u7684 hotAddUpdateChunk \u65B9\u6CD5\u52A8\u6001\u66F4\u65B0\u6A21\u5757\u4EE3\u7801</td><td>https://github.com/webpack/webpack/blob/v4.39.1/lib/HotModuleReplacement.runtime.js#L222</td></tr><tr><td>11.\u7136\u540E\u8C03\u7528 hotApply \u65B9\u6CD5\u8FDB\u884C\u70ED\u66F4\u65B0</td><td>https://github.com/webpack/webpack/blob/v4.39.1/lib/HotModuleReplacement.runtime.js#L257 https://github.com/webpack/webpack/blob/v4.39.1/lib/HotModuleReplacement.runtime.js#L278</td></tr><tr><td>12.\u4ECE\u7F13\u5B58\u4E2D\u5220\u9664\u65E7\u6A21\u5757</td><td>https://github.com/webpack/webpack/blob/v4.39.1/lib/HotModuleReplacement.runtime.js#L510</td></tr><tr><td>13.\u6267\u884C accept \u7684\u56DE\u8C03</td><td>https://github.com/webpack/webpack/blob/v4.39.1/lib/HotModuleReplacement.runtime.js#L569</td></tr></tbody></table>',6),c=[a];function s(p,o){return e(),d("div",null,c)}var l=t(b,[["render",s],["__file","HMR\u539F\u7406.html.vue"]]);export{l as default};
