import{_ as l}from"./plugin-vue_export-helper.21dcd24c.js";import{o as d,c,d as a,a as e,b as s,e as o,r as i}from"./app.da104442.js";const t={},p=e("h1",{id:"module-\u6A21\u5757\u4F7F\u7528",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#module-\u6A21\u5757\u4F7F\u7528","aria-hidden":"true"},"#"),s(" module \u6A21\u5757\u4F7F\u7528")],-1),r=e("h2",{id:"resolvefilename",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#resolvefilename","aria-hidden":"true"},"#"),s(" _resolveFilename")],-1),u=e("p",null,[e("strong",null,"\u4F5C\u7528\uFF1A\u89E3\u6790\u6A21\u5757\u7684\u771F\u5B9E\u8DEF\u5F84\uFF0C\u4F8B\u5982\u76F8\u5BF9\u8DEF\u5F84\u89E3\u6790\u4E3A\u7EDD\u5BF9\u8DEF\u5F84\u3002")],-1),E=o(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> parent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> fromFile<span class="token punctuation">,</span> <span class="token comment">// \u6587\u4EF6\u8DEF\u5F84</span>
  <span class="token literal-property property">filename</span><span class="token operator">:</span> fromFile<span class="token punctuation">,</span> <span class="token comment">// \u6587\u4EF6\u8DEF\u5F84</span>
  <span class="token literal-property property">paths</span><span class="token operator">:</span> Module<span class="token punctuation">.</span><span class="token function">_nodeModulePaths</span><span class="token punctuation">(</span>fromDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// \u83B7\u53D6\u6240\u6709node_modules\u53EF\u80FD\u7684\u4F4D\u7F6E</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// \u7B2C\u4E8C\u4E2A\u53C2\u6570\u5B9E\u9645\u4E0A\u662F\u7236\u6A21\u5757\u5BF9\u8C61</span>
Module<span class="token punctuation">.</span><span class="token function">_resolveFilename</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nodemodulepaths" tabindex="-1"><a class="header-anchor" href="#nodemodulepaths" aria-hidden="true">#</a> _nodeModulePaths</h2><p>\u4F5C\u7528\uFF1A\u751F\u6210 node_modules \u53EF\u80FD\u7684\u8DEF\u5F84\uFF0C\u4F8B\u5982</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Module<span class="token punctuation">.</span><span class="token function">_nodeModulePaths</span><span class="token punctuation">(</span>fromDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fromDir: /home/yuangong/tmp</span>

<span class="token comment">// [ &#39;/home/yuangong/tmp/node_modules&#39;,</span>
<span class="token comment">// &#39;/home/yuangong/node_modules&#39;,</span>
<span class="token comment">// &#39;/home/node_modules&#39;,</span>
<span class="token comment">// &#39;/node_modules&#39; ]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="findpath" tabindex="-1"><a class="header-anchor" href="#findpath" aria-hidden="true">#</a> _findPath</h2>`,5),m=o('<h2 id="node-\u6A21\u5757\u89E3\u6790\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#node-\u6A21\u5757\u89E3\u6790\u6D41\u7A0B" aria-hidden="true">#</a> Node \u6A21\u5757\u89E3\u6790\u6D41\u7A0B</h2><ul><li><p>Nodejs \u9879\u76EE\u6A21\u5757\u8DEF\u5F84\u89E3\u6790\u662F\u901A\u8FC7<code>require.resolve</code>\u65B9\u6CD5\u6765\u5B9E\u73B0\u7684</p></li><li><p><code>require.resolve</code>\u5C31\u662F\u901A\u8FC7<code>Module.resolveFileName</code> \u65B9\u6CD5\u5B9E\u73B0\u7684</p></li><li><p><code>require.resolve</code>\u5B9E\u73B0\u539F\u7406:</p><ul><li><p><code>Module.resolveFileName</code>\u65B9\u6CD5\u6838\u5FC3\u6D41\u7A0B\u6709 3 \u70B9:</p><ul><li>\u5224\u65AD\u662F\u5426\u4E3A\u5185\u7F6E\u6A21\u5757</li><li>\u901A\u8FC7<code>ModuleresolveLookupPaths</code>\u65B9\u6CD5\u751F\u6210<code>node_modules</code>\u53EF\u80FD\u5B58\u5728\u7684\u8DEF\u5F84</li><li>\u901A\u8FC7<code>Module.findPath</code>\u67E5\u8BE2\u6A21\u5757\u7684\u771F\u5B9E\u8DEF\u5F84</li></ul></li><li><p><code>Module.findPath</code>\u6838\u5FC3\u6D41\u7A0B\u6709 4 \u70B9:</p><ul><li>\u67E5\u8BE2\u7F13\u5B58(\u5C06<code>request\u548Cpaths</code>\u901A\u8FC7<code>\\x00</code>\u5408\u5E76\u6210 cacheKey)</li><li>\u904D\u5386 paths \u5C06<code>path\u4E0Erequest</code>\u7EC4\u6210\u6587\u4EF6\u8DEF\u5F84<code>basePath</code></li><li>\u5982\u679C<code>basePath</code>\u5B58\u5728\u5219\u8C03\u7528<code>fs.realPathSync</code>\u83B7\u53D6\u6587\u4EF6\u771F\u5B9E\u8DEF\u5F84</li><li>\u5C06\u6587\u4EF6\u771F\u5B9E\u8DEF\u5F84\u7F13\u5B58\u5230<code>Module.pathCache</code>(key \u5C31\u662F\u524D\u9762\u751F\u6210\u7684 cacheKey)\u3002</li></ul></li><li><p><code>fs.realPathSync</code>\u6838\u5FC3\u6D41\u7A0B\u6709 3 \u70B9:</p><ul><li>\u67E5\u8BE2\u7F13\u5B58(\u7F13\u5B58\u7684 key \u4E3A p \u5373<code>Module.findPath</code>\u4E2D\u751F\u6210\u7684\u6587\u4EF6\u8DEF\u5F84) \u66F4\u591A\u8BFE\u7A0B\u8857</li><li>\u4ECE\u5DE6\u5F80\u53F3\u904D\u5386\u8DEF\u5F84\u5B57\u7B26\u4E32\uFF0C\u67E5\u8BE2\u5230<code>/</code>\u65F6\uFF0C\u62C6\u5206\u8DEF\u5F84\uFF0C\u5224\u65AD\u8BE5\u8DEF\u5F84\u662F\u5426\u4E3A\u8F6F\u94FE\u63A5\uFF0C\u5982\u679C\u662F\u8F6F\u94FE\u63A5\u5219\u67E5\u8BE2\u771F\u5B9E\u94FE\u63A5\uFF0C\u5E76\u751F\u6210\u65B0\u8DEF\u5F84 p \u7136\u540E\u7EE7\u7EED\u5F80\u540E\u904D\u5386\uFF0C\u8FD9\u91CC\u6709 1 \u4E2A\u7EC6\u8282\u9700\u8981\u7279\u522B\u6CE8\u610F: <ul><li>\u904D\u5386\u8FC7\u7A0B\u4E2D\u751F\u6210\u7684\u5B50\u8DEF\u5F84 base \u4F1A\u7F13\u5B58\u5728 knownHard \u548C cache \u4E2D\uFF0C\u907F\u514D\u91CD\u590D\u67E5\u8BE2</li></ul></li><li>\u904D\u5386\u5B8C\u6210\u5F97\u5230\u6A21\u5757\u5BF9\u5E94\u7684\u771F\u5B9E\u8DEF\u5F84\uFF0C\u6B64\u65F6\u4F1A\u5C06\u539F\u59CB\u8DEF\u8DEF\u5F84 original \u4F5C\u4E3A key\uFF0C\u771F\u5B9E\u8DEF\u5F84\u4F5C\u4E3A value\uFF0C\u4FDD\u5B58\u5230\u7F13\u5B58\u4E2D</li></ul></li></ul></li><li><p><code>require.resolve.paths</code>\u7B49\u4EF7\u4E8E<code>Module.resolveLookupPaths</code>\uFF0C\u8BE5\u65B9\u6CD5\u7528\u4E8E\u83B7\u53D6\u6240\u6709<code>node_modules</code></p><ul><li>\u5982\u679C\u8DEF\u5F84\u4E3A/(\u6839\u76EE\u5F55)\uFF0C\u76F4\u63A5\u8FD4\u56DE<code>[&#39;/node_modules&#39;]</code></li><li>\u5426\u5219\uFF0C\u5C06\u8DEF\u5F84\u5B57\u7B26\u4E32\u4ECE\u540E\u5F80\u524D\u904D\u5386\uFF0C\u67E5\u8BE2\u5230/\u65F6\uFF0C\u62C6\u5206\u8DEF\u5F84\uFF0C\u5728\u540E\u9762\u52A0\u4E0A<code>node_modules</code>\uFF0C\u5E76\u4F20\u5165\u4E00\u4E2A<code>paths</code>\u6570\u7EC4\uFF0C\u76F4\u81F3\u67E5\u8BE2\u4E0D\u5230<code>/</code>\u540E\u8FD4\u56DE<code>paths</code>\u6570\u7EC4</li></ul></li></ul>',2);function h(v,A){const n=i("Mermaid");return d(),c("div",null,[p,r,u,a(n,{id:"mermaid-1a962853",code:"flowchart%20TB%3B%0A%20%20a(Module._resolveFilename)%20--%3E%20b%7B%E6%98%AF%E5%90%A6%E4%B8%BA%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97%7D%0A%20%20b%20--%3E%20%7C%E5%90%A6%7Cd(Module._resolveLookupPaths%2C%20%E5%B0%86paths%E5%92%8C%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8Fnode_modules%E5%90%88%E5%B9%B6)%0A%20%20b%20--%3E%20%7C%E6%98%AF%7Cc(End)%0A%20%20d%20--%3E%20f(Module._findPath%2C%E5%9C%A8paths%E4%B8%AD%E8%A7%A3%E6%9E%90%E6%A8%A1%E5%9D%97%E7%9A%84%E7%9C%9F%E5%AE%9E%E8%B7%AF%E5%BE%84)%0A%20%20f%20--%3E%20c%0A"}),E,a(n,{id:"mermaid-382ee165",code:"flowchart%20TB%3B%0A%20%20a(Module._findPath)%20--%3E%20b%7B%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98%7D%0A%20%20b%20--%3E%20%7C%E6%98%AF%7Cc(%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C)%0A%20%20c%20--%3E%20d(End)%0A%20%20b%20--%3E%20%7C%E5%90%A6%7Ce(%E9%81%8D%E5%8E%86paths%2C%E5%90%88%E5%B9%B6path%E5%92%8Crequest)%0A%20%20e%20--%3E%20f%7B%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%7D%0A%20%20f%20--%3E%20%7C%E5%90%A6%7Ce%0A%20%20f%20--%3E%20%7C%E6%98%AF%7Cg(%E8%B0%83%E7%94%A8toRealPath%E7%94%9F%E6%88%90%E7%9C%9F%E5%AE%9E%E8%B7%AF%E5%BE%84)%0A%20%20g%20--%3E%20h%7B%E8%B7%AF%E5%BE%84%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%7D%0A%20%20h%20--%3E%20%7C%E6%98%AF%7Cd%0A%20%20h%20--%3E%20%7C%E5%90%A6%7Ce%0A"}),m])}var f=l(t,[["render",h],["__file","module\u6A21\u5757\u4F7F\u7528.html.vue"]]);export{f as default};
